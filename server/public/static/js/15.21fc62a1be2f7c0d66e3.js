webpackJsonp([15],{1008:function(t,e,a){a(1208);var s=a(377)(a(1113),a(1181),null,null);t.exports=s.exports},1015:function(t,e,a){t.exports={default:a(1016),__esModule:!0}},1016:function(t,e,a){var s=a(124),i=s.JSON||(s.JSON={stringify:JSON.stringify});t.exports=function(t){return i.stringify.apply(i,arguments)}},1113:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(1015),i=a.n(s);e.default={data:function(){return{form:{userId:"",docId:"",wavFile:"",txtFile:""},aggressiveness:1,isBroad:!1,isEdit:!1,fromVersion:-1,dataLocation:"",showLoader:!1,dialog:!1,taskId:"",id:"",show:!1,showWavUpload:!1,showTextUpload:!0,showText:!1,text:"",tableData:[],wavLocation:"",text_parseUrl:"/api/tools/sts/text_parse",wav_parseUrl:"/api/tools/sts/wav_parse",submitUrl:"/api/tools/sts/submit",getTaskDetailPrefix:"/api/tools/sts/task/",getTaskVersionDetailPrefix:"/api/tools/sts/task/",getTaskListUr:"/api/tools/sts/task",wttUrl:"/api/tools/sts/wavStt",search_field:"",search_key:"",isMarkNew:!1}},components:{},created:function(){var t=this.$route.query||{};t.id&&(this.id=t.id,this.taskId=t.taskId,t.isMarkNew?(this.isMarkNew=!0,this.fromVersion=-1,this.doNewMarkViewChange()):(this.isEdit=!0,this.fromVersion=+t.version||0,this.doEditorViewChange())),t.search_field&&(this.search_field=t.search_field),t.search_key&&(this.search_key=t.search_key),this.isBroad=!!t.is_broadcast,t.aggressiveness&&(this.aggressiveness=+t.aggressiveness||0)},computed:{},methods:{doNewMarkViewChange:function(){var t=this;this.showTextUpload=!1,this.$axios.get(this.getTaskDetailPrefix+this.id).then(function(e){var a=e.data;if(a.errCode)return t.$message.error(a.errMsg||"响应异常");t.renderParsedData(a.data)})},doEditorViewChange:function(){var t=this;this.showTextUpload=!1,this.$axios.get(this.getTaskVersionDetailPrefix+this.id+"/"+this.fromVersion).then(function(e){var a=e.data;if(a.errCode)return t.$message.error(a.errMsg||"响应异常");t.renderParsedData(a.data)})},setClassName:function(t,e){return t.isDeleted?"need-hide":"not-need-hide"},onLoadWav:function(t){this.updateTableData(t)},wttReq:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.tableData[e]){var a=this.tableData[e].name;this.$axios.get(this.wttUrl+"?path="+this.dataLocation+"/"+a).then(function(a){t.tableData[e].textDisplay=!0,t.tableData[e].text=a.data.data.text,t.wttReq(++e)}).catch(function(a){return t.tableData[e].textDisplay=!0,t.tableData[e].text="请求异常",t.wttReq(++e)})}},updateTableData:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=this.tableData.length,s=0,i=0;i<a;i++)this.tableData[i].audio="";for(var o=t;o<a&&s<=e;o++)this.tableData[o].isDeleted||(this.tableData[o].audio=this.tableData[o].link,s++)},renderParsedData:function(t){var e=this;this.showLoader=!1,t.wavList.forEach(function(a){e.dataLocation=t.location,e.tableData.push({link:t.location+"/"+a,name:a,audio:"",text:"",isDelete:!1,textDisplay:!1})}),this.text=this.isMarkNew?t.splitedReviewedTextList.join("\r\n"):t.textList.join("\r\n"),this.updateTableData(0,10),this.wttReq(),this.show=!0},onDelWav:function(t,e){this.tableData[t].audio="",this.tableData[t].isDeleted=!0},onWavSelect:function(t){var e=this;this.showText=!1,this.showLoader=!0;var a=this.text.split("\n");a.map(function(t){return t.trim()});var s=i()({id:this.id,taskId:this.taskId,textList:a,aggressiveness:this.aggressiveness}),o=new FormData;o.append("jsonData",s),o.append("wav",t.target.files[0]),this.showWavUpload=!1,this.$axios.post(this.wav_parseUrl,o).then(function(t){e.showLoader=!1;var a=t.data;if(a.errCode)return e.$message.error(a.errMsg||"响应异常");e.$message.success("提交成功, 请继续录音或者去标注"),setTimeout(function(){e.$router.push({path:"/sts_list?search_field="+encodeURIComponent(e.search_field)+"&search_key="+encodeURIComponent(e.search_key)})},1500)})},clickWavBtn:function(){document.getElementById("uploadWavBtn").click()},onTxtSelect:function(t){return this.form.txtFile=t.target.files[0]},onCancelUpload:function(){this.dialog=!1},onPreParse:function(){return this.dialog=!1,this.form.userId&&this.form.docId&&this.form.txtFile?+this.form.userId?/^\d+[-_\d]*$/.test(this.form.docId)?(this.show=!1,this.showLoader=!0,this.tableData=[],void this.doPreParse()):this.$message.error("无效文档ID，文档ID最多只能包含数字_(下划线)-(横杠)"):this.$message.error("无效姓名ID，姓名ID必须是数字"):this.$message.error("请输入姓名ID、文档ID，并上传.txt文件")},doPreParse:function(){var t=this,e=new FormData;e.append("userId",this.form.userId),e.append("docId",this.form.docId),e.append("txt",this.form.txtFile),this.$axios.post(this.text_parseUrl,e).then(function(e){var a=e.data;return a.errCode?t.$message.error(a.errMsg||"文本解析失败"):a.data&&a.data._id?(t.taskId=a.data.taskId,t.showLoader=!1,t.showTextUpload=!1,t.showWavUpload=!0,t.showText=!0,t.text=a.data.originTextList.join("\r\n"),void(t.id=a.data._id)):t.$message.error("返回数据异常，获取不到ID， 请联系管理员")})},submit:function(){var t=this,e=this.text.split("\n");for(var a in e){if(e[a]=e[a].trim(),!e[a])return this.$message.error("第"+(parseInt(a)+1)+"行没有文字");if(/[\/①②③④⑤⑥⑦⑧⑨⑩IⅡⅢVⅤⅥⅦⅧⅨⅩ、＇：∶‘’“”〝〞ˆˇ﹕︰﹑·¨….´～—ˉ\\｜‖＂〃｀@﹫¡¿﹟#﹩$﹠﹪%*﹡﹢﹦﹤‐￣¯―﹨˜+=­＿_\-~（）〈〉《》‹›﹛﹜]/g.test(e[a]))return this.$message.error("第"+(parseInt(a)+1)+"行存在特殊标点");var s=e[a].split(/\s+/);e[a]=s.join(" ")}var o=[];for(var r in this.tableData)!this.tableData[r].isDeleted&&o.push(this.tableData[r].name);if(e.length!==o.length)return this.$message.error("语音文件数量不等于文本行数");var n=i()({taskId:this.taskId,textList:e,wavList:o,id:this.id,fromVersion:this.fromVersion}),l=new FormData;l.append("jsonData",n),this.$axios.post(this.submitUrl,l).then(function(e){var a=e.data;if(a.errCode)return t.$message.error(a.errMsg||"提交异常，请联系管理员, 或尝试等待几秒后重新提交");t.$message.success("提交成功"),t.tableData=[],setTimeout(function(){t.$router.push({path:"/sts_list?search_field="+encodeURIComponent(t.search_field)+"&search_key="+encodeURIComponent(t.search_key)})},1500)})}}}},1127:function(t,e,a){var s=a(988);e=t.exports=a(164)(!1),e.push([t.i,".need-hide{display:none}#click-upload-btn{margin-bottom:10px}.sts-dialog .el-dialog--small{position:absolute;width:300px;border-radius:5px;padding-left:30px}.block-dom{position:relative;width:195px;margin-left:28px}.block-dom button{width:65px}#uploadWavBtn{display:none}#headBlock{position:relative;width:calc(100% - 2px);height:39px;background-color:#eef1f6;clear:both;float:left;margin-left:10px;border:1px solid #dfe6ec;border-bottom:none}#right-area{float:left;width:calc(100% - 560px)}.text-area{width:100%;clear:both;float:left;margin-left:10px}.sts-table{width:556px;float:left}.text-area .el-textarea__inner{line-height:40px;font-size:18px;padding:0 7px;border-radius:2px;border:1px solid #dfe6ec;background-image:url("+s(a(1170))+');white-space:nowrap}.submit{padding-top:10px;clear:both}.hidden{display:none}input{margin-bottom:20px;width:calc(100% - 59px)}.sts-dialog .el-input{width:calc(100% - 59px);float:left}.sts-dialog .el-input__inner{height:auto;width:76%}.block-dom{display:block!important}.sts-dialog .el-form-item{margin-bottom:10px}.el-table .cell{white-space:nowrap}.loader{width:250px;height:50px;line-height:50px;text-align:center;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:helvetica,arial,sans-serif;text-transform:uppercase;font-weight:900;color:#20a0ff;letter-spacing:.2em}.loader:after,.loader:before{content:"";display:block;width:15px;height:15px;background:#20a0ff;position:absolute;animation:load .7s infinite alternate ease-in-out}.loader:before{top:0}.loader:after{bottom:0}@keyframes load{0%{left:0;height:30px;width:15px}50%{height:8px;width:40px}to{left:235px;height:30px;width:15px}}',""])},1170:function(t,e,a){t.exports=a.p+"static/img/line.e207a29.jpg"},1181:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table"},[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-menu"}),t._v(" 服务管理")]),t._v(" "),t.isBroad?t._e():a("el-breadcrumb-item",[t._v("语音分片标注")]),t._v(" "),t.isBroad?a("el-breadcrumb-item",[a("span",{staticStyle:{color:"#fd6853"}},[t._v("广播语音标注专用（自动分句对间隔更敏感, 大于15秒的音频直接删掉）")])]):t._e()],1)],1),t._v(" "),a("div",{staticClass:"my-box"},[t.showTextUpload?a("el-button",{attrs:{type:"primary",id:"click-upload-btn"},on:{click:function(e){t.dialog=!0}}},[t._v("点击上传文本")]):t._e(),t._v(" "),t.showWavUpload?a("el-button",{attrs:{type:"warning"},on:{click:t.clickWavBtn}},[t._v("上传音频")]):t._e(),t._v(" "),a("el-row",[a("input",{attrs:{type:"file",accept:"audio/wav",id:"uploadWavBtn"},on:{change:t.onWavSelect}})]),t._v(" "),a("el-dialog",{staticClass:"sts-dialog",attrs:{visible:t.dialog},on:{"update:visible":function(e){t.dialog=e}}},[a("el-form",{ref:"form",staticClass:"demo-form-inline",attrs:{model:t.form}},[a("el-form-item",{attrs:{label:"姓名ID:"}},[a("el-input",{attrs:{placeholder:"请输入姓名ID"},model:{value:t.form.userId,callback:function(e){t.$set(t.form,"userId",e)},expression:"form.userId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"文档ID:"}},[a("el-input",{attrs:{placeholder:"请输入文档ID"},model:{value:t.form.docId,callback:function(e){t.$set(t.form,"docId",e)},expression:"form.docId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"文档:"}},[a("input",{attrs:{type:"file",accept:".txt"},on:{change:t.onTxtSelect}})]),t._v(" "),a("el-form-item",{staticClass:"block-dom"},[a("el-button",{on:{click:t.onCancelUpload}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.onPreParse}},[t._v("提交")])],1)],1)],1),t._v(" "),a("el-row",[t.showText?a("el-input",{staticClass:"text-area",attrs:{type:"textarea",autosize:"",placeholder:"请输入内容"},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}}):t._e()],1),t._v(" "),t.showLoader?a("el-row",{staticClass:"loader"},[t._v("处理中...")]):t._e(),t._v(" "),t.show?a("div",[a("el-table",{staticClass:"sts-table",attrs:{data:t.tableData,"row-class-name":t.setClassName}},[a("el-table-column",{staticClass:"line-number",attrs:{type:"index",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{label:"文件名",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.name))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"参考文本",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.textDisplay?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[t._v(t._s(e.row.text))]),t._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"medium"}},[t._v(t._s(e.row.text))])],1)]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"删除",width:"65"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"danger",width:"80"},on:{click:function(a){t.onDelWav(e.$index,e.row)}}},[t._v("删除")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"音频",width:"190"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.audio?t._e():a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){t.onLoadWav(e.$index)}}},[t._v("点击载入音频")]),t._v(" "),e.row.audio?a("audio",{attrs:{controls:"",src:e.row.audio}}):t._e()]}}])})],1),t._v(" "),a("el-row",{attrs:{id:"right-area"}},[a("div",{attrs:{id:"headBlock"}}),t._v(" "),a("el-input",{staticClass:"text-area",attrs:{type:"textarea",autosize:"",placeholder:"请输入内容"},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}})],1),t._v(" "),a("el-row",{staticClass:"submit"},[a("el-button",{attrs:{type:"success"},on:{click:t.submit}},[t._v("提交")])],1)],1):t._e()],1)])},staticRenderFns:[]}},1208:function(t,e,a){var s=a(1127);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);a(378)("7afae741",s,!0)}});